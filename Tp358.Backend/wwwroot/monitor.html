<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP358 Backend Monitor</title>
    <link rel="stylesheet" href="/monitor.css">
</head>
<body>
    <div class="container">
        <h1>üå°Ô∏è TP358 Backend Monitor</h1>

        <div class="status">
            <div class="status-left">
                <div class="status-line status-line-main">
                    <div class="status-indicator"></div>
                    <span id="connectionStatus">Backend</span>
                </div>
                <div class="status-line status-line-ble">
                    <span id="bleAdapterStatus" class="status-adapter">BLE: n/a</span>
                    <span id="bleSignalDot" class="ble-status-dot is-unknown" title="BLE Status"></span>
                    <span id="bleSignalStatus" class="status-warning" style="display: none;"></span>
                </div>
            </div>
            <div class="status-db">
                <span id="dbEsp32Host" class="status-db-line">DB-esp32: n/a</span>
                <span id="dbTp358Host" class="status-db-line">DB-tp358: n/a</span>
            </div>
            <div class="status-actions">
                <div class="status-actions-left">
                    <button id="homeViewButton" class="view-btn active" type="button">Home</button>
                    <button id="graphViewButton" class="view-btn" type="button">GRAPH</button>
                    <button id="flowViewButton" class="view-btn" type="button">Vor-R√ºcklauf</button>
                    <button id="monitorViewButton" class="view-btn" type="button">Monitor</button>
                    <button id="oldFlowViewButton" class="view-btn" type="button">Fit-View</button>
                    <button id="settingsViewButton" class="view-btn" type="button">Settings</button>
                </div>
                <div class="status-actions-right">
                    <button id="shutdownButton" class="shutdown-btn" type="button" disabled>
                        Backend Stop
                    </button>
                </div>
            </div>
        </div>

        <div id="homeView">
            <div id="sensorsContainer" class="sensors-grid"></div>

            <div id="noData" class="no-data" style="display: none;">
                Warte auf Sensordaten...
            </div>
        </div>

        <div id="graphView" class="graph-view" style="display: none;">
            <div id="graphControls" class="status-controls flow-controls graph-controls">
                <div class="control-group control-left">
                    <button class="view-btn time-btn" type="button" data-hours="12">12h</button>
                    <button class="view-btn time-btn active" type="button" data-hours="24">1 Tag</button>
                    <button class="view-btn time-btn" type="button" data-hours="48">2 Tage</button>
                    <button class="view-btn time-btn" type="button" data-hours="168">1 Woche</button>
                </div>
                <div class="control-group control-right">
                    <button id="humidityToggleButton" class="view-btn" type="button">Humidity</button>
                    <button class="view-btn smooth-btn active" type="button" data-smooth="A">A Median</button>
                    <button class="view-btn smooth-btn" type="button" data-smooth="B">B EMA</button>
                    <div class="smooth-window">
                        <button id="smoothMinus" class="view-btn smooth-adjust" type="button">-</button>
                        <span id="smoothMinutesLabel" class="smooth-label">2 min</span>
                        <button id="smoothPlus" class="view-btn smooth-adjust" type="button">+</button>
                    </div>
                </div>
            </div>
            <div id="graphContainer"></div>
            <div id="graphNoData" class="no-data" style="display: none;">
                Keine Messwerte in der Datenbank gefunden.
            </div>
        </div>

        <div id="flowView" class="graph-view" style="display: none;">
            <div id="flowControls" class="status-controls flow-controls">
                <div class="control-group control-left">
                    <button class="view-btn flow-time-btn" type="button" data-hours="12">12h</button>
                    <button class="view-btn flow-time-btn active" type="button" data-hours="24">1 Tag</button>
                    <button class="view-btn flow-time-btn" type="button" data-hours="48">2 Tage</button>
                    <button class="view-btn flow-time-btn" type="button" data-hours="168">1 Woche</button>
                </div>
                <div class="control-group control-right">
                    <div class="flow-energy-start">
                        <label class="control-label" for="flowEnergyStart">Start</label>
                        <input id="flowEnergyStart" class="flow-date" type="datetime-local">
                    </div>
                    <button class="view-btn flow-smooth-btn active" type="button" data-smooth="A">A Median</button>
                    <button class="view-btn flow-smooth-btn" type="button" data-smooth="B">B EMA</button>
                    <div class="smooth-window">
                        <button id="flowSmoothMinus" class="view-btn smooth-adjust" type="button">-</button>
                        <span id="flowSmoothMinutesLabel" class="smooth-label">2 min</span>
                        <button id="flowSmoothPlus" class="view-btn smooth-adjust" type="button">+</button>
                    </div>
                </div>
            </div>
            <div id="flowContainer"></div>
            <div id="flowNoData" class="no-data" style="display: none;">
                Keine Messwerte in der Datenbank gefunden.
            </div>
        </div>

        <div id="monitorView" class="graph-view" style="display: none;">
            <div id="monitorControls" class="status-controls flow-controls">
                <div class="control-group control-left">
                    <div class="smooth-window">
                        <button id="monitorMinutesMinus" class="view-btn smooth-adjust" type="button">-</button>
                        <span id="monitorMinutesLabel" class="smooth-label">20 min</span>
                        <button id="monitorMinutesPlus" class="view-btn smooth-adjust" type="button">+</button>
                    </div>
                    <button id="monitorSmoothToggle" class="view-btn" type="button">Gl√§ttung: Aus</button>
                </div>
            </div>
            <div id="monitorContainer"></div>
            <div id="monitorNoData" class="no-data" style="display: none;">
                Keine Messwerte in der Datenbank gefunden.
            </div>
        </div>

        <div id="oldFlowView" class="graph-view" style="display: none;">
            <div id="oldFlowControls" class="status-controls flow-controls">
                <div class="control-group control-left">
                    <button class="view-btn old-flow-time-btn" type="button" data-hours="12">12h</button>
                    <button class="view-btn old-flow-time-btn active" type="button" data-hours="24">1 Tag</button>
                    <button class="view-btn old-flow-time-btn" type="button" data-hours="48">2 Tage</button>
                    <button class="view-btn old-flow-time-btn" type="button" data-hours="168">1 Woche</button>
                    <button id="oldFlowFitButton" class="view-btn old-flow-fit-btn" type="button">FitToView</button>
                </div>
                <div class="control-group control-right">
                    <div class="flow-energy-start">
                        <label class="control-label" for="oldFlowEnergyStart">Start</label>
                        <input id="oldFlowEnergyStart" class="flow-date" type="datetime-local">
                    </div>
                    <button class="view-btn old-flow-smooth-btn active" type="button" data-smooth="A">A Median</button>
                    <button class="view-btn old-flow-smooth-btn" type="button" data-smooth="B">B EMA</button>
                    <div class="smooth-window">
                        <button id="oldFlowSmoothMinus" class="view-btn smooth-adjust" type="button">-</button>
                        <span id="oldFlowSmoothMinutesLabel" class="smooth-label">2 min</span>
                        <button id="oldFlowSmoothPlus" class="view-btn smooth-adjust" type="button">+</button>
                    </div>
                </div>
            </div>
            <div id="oldFlowContainer"></div>
            <div id="oldFlowNoData" class="no-data" style="display: none;">
                Keine Messwerte in der Datenbank gefunden.
            </div>
        </div>

        <div id="settingsView" class="graph-view" style="display: none;">
            <div class="settings-card">
                <h2 class="settings-title">Intervalle</h2>
                <p class="settings-subtitle">Gilt pro Ger√§t. Werte werden beim Backend-Start aus appsettings.json geladen.</p>

                <div class="settings-row">
                    <label class="settings-label" for="settingsSignalRInterval">SignalR (Browser)</label>
                    <input id="settingsSignalRInterval" class="settings-range" type="range" min="30" max="900" step="30" value="60">
                    <span id="settingsSignalRValue" class="settings-value">60 s</span>
                </div>

                <div class="settings-row">
                    <label class="settings-label" for="settingsDbInterval">Datenbank</label>
                    <input id="settingsDbInterval" class="settings-range" type="range" min="30" max="900" step="30" value="300" disabled>
                    <span id="settingsDbValue" class="settings-value">5 min (fix)</span>
                </div>

                <div class="settings-row">
                    <label class="settings-label" for="settingsBleWarningInterval">BLE Warnung</label>
                    <input id="settingsBleWarningInterval" class="settings-range" type="range" min="30" max="900" step="30" value="300">
                    <span id="settingsBleWarningValue" class="settings-value">5 min</span>
                </div>

                <div class="settings-actions">
                    <button id="settingsSaveButton" class="view-btn" type="button">Speichern</button>
                    <span id="settingsStatus" class="settings-status"></span>
                </div>
            </div>
        </div>
    </div>

    <script src="/monitor.config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
    <script src="/monitor.js"></script>
    
</body>
</html>
